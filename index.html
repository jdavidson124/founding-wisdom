<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="theme-color" content="#1a1209"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<meta name="apple-mobile-web-app-title" content="Founding Wisdom"/>
<link rel="manifest" href="manifest.json"/>
<title>Founding Wisdom</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Crimson+Pro:ital,wght@0,300;0,400;1,300&display=swap" rel="stylesheet"/>

<style>
  :root {
    --ink: #1a1209;
    --parchment: #f5edd6;
    --gold: #b8860b;
    --gold-light: #d4a017;
    --rust: #8b3a0f;
    --sage: #4a5e3a;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    background: var(--ink);
    color: var(--parchment);
    font-family: 'Crimson Pro', Georgia, serif;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background:
      radial-gradient(ellipse at 20% 20%, rgba(184,134,11,0.08) 0%, transparent 50%),
      radial-gradient(ellipse at 80% 80%, rgba(139,58,15,0.08) 0%, transparent 50%),
      repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(245,237,214,0.015) 2px, rgba(245,237,214,0.015) 4px);
    pointer-events: none;
    z-index: 0;
  }

  .container {
    position: relative;
    z-index: 1;
    max-width: 700px;
    margin: 0 auto;
    padding: 2rem 1.5rem 4rem;
  }

  header {
    text-align: center;
    padding: 2.5rem 0 2rem;
    border-bottom: 1px solid rgba(184,134,11,0.3);
    margin-bottom: 2.5rem;
    position: relative;
  }

  header::after {
    content: '‚ú¶ ‚ú¶ ‚ú¶';
    position: absolute;
    bottom: -0.6rem;
    left: 50%;
    transform: translateX(-50%);
    background: var(--ink);
    padding: 0 1rem;
    font-size: 0.6rem;
    color: var(--gold);
    letter-spacing: 0.4em;
  }

  .app-label {
    font-size: 0.7rem;
    font-weight: 300;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: var(--gold);
    margin-bottom: 0.75rem;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: clamp(2rem, 6vw, 3.2rem);
    font-weight: 400;
    line-height: 1.1;
  }

  h1 em { font-style: italic; color: var(--gold-light); }

  .subtitle {
    margin-top: 0.75rem;
    font-size: 0.95rem;
    font-weight: 300;
    color: rgba(245,237,214,0.6);
    letter-spacing: 0.05em;
  }

  /* API Key Setup */
  .api-setup {
    background: rgba(184,134,11,0.07);
    border: 1px solid rgba(184,134,11,0.3);
    border-radius: 2px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
  }

  .api-setup-title {
    font-family: 'Playfair Display', serif;
    font-size: 1.1rem;
    color: var(--gold-light);
    margin-bottom: 0.5rem;
  }

  .api-setup p {
    font-size: 0.88rem;
    font-weight: 300;
    color: rgba(245,237,214,0.65);
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .api-setup a { color: var(--gold-light); text-underline-offset: 3px; }

  .api-input-row {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .api-input {
    flex: 1;
    min-width: 200px;
    padding: 0.75rem 1rem;
    background: rgba(245,237,214,0.05);
    border: 1px solid rgba(184,134,11,0.35);
    border-radius: 1px;
    color: var(--parchment);
    font-family: 'Crimson Pro', serif;
    font-size: 0.9rem;
    outline: none;
    transition: border-color 0.2s;
  }

  .api-input:focus { border-color: var(--gold); }
  .api-input::placeholder { color: rgba(245,237,214,0.25); }

  /* Quote Card */
  .quote-card {
    background: linear-gradient(135deg, rgba(245,237,214,0.06) 0%, rgba(245,237,214,0.02) 100%);
    border: 1px solid rgba(184,134,11,0.25);
    border-radius: 2px;
    padding: 2.5rem 2rem;
    margin-bottom: 1.5rem;
    position: relative;
    animation: fadeUp 0.8s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  @keyframes fadeUp {
    to { opacity: 1; transform: translateY(0); }
  }

  .quote-card::before {
    content: '\201C';
    position: absolute;
    top: -0.5rem;
    left: 1.5rem;
    font-family: 'Playfair Display', serif;
    font-size: 5rem;
    color: var(--gold);
    opacity: 0.2;
    line-height: 1;
  }

  .author-tag {
    display: inline-block;
    font-size: 0.65rem;
    font-weight: 400;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--gold);
    border: 1px solid rgba(184,134,11,0.4);
    padding: 0.2rem 0.75rem;
    margin-bottom: 1.5rem;
    border-radius: 1px;
  }

  .original-quote {
    font-family: 'Playfair Display', serif;
    font-size: clamp(1.1rem, 3vw, 1.4rem);
    font-style: italic;
    line-height: 1.65;
    color: var(--parchment);
    margin-bottom: 0.75rem;
  }

  .quote-meta {
    font-size: 0.75rem;
    color: rgba(245,237,214,0.35);
    letter-spacing: 0.15em;
    margin-bottom: 1.75rem;
  }

  .divider {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin: 1.5rem 0;
  }

  .divider::before, .divider::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(184,134,11,0.2);
  }

  .divider span {
    font-size: 0.6rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--gold);
    opacity: 0.7;
  }

  .section-label {
    font-size: 0.6rem;
    letter-spacing: 0.3em;
    text-transform: uppercase;
    color: var(--gold);
    opacity: 0.7;
    margin-bottom: 0.6rem;
  }

  .modern-translation {
    font-size: 1.05rem;
    font-weight: 300;
    line-height: 1.7;
    color: rgba(245,237,214,0.88);
    margin-bottom: 1.5rem;
    padding-left: 1rem;
    border-left: 2px solid rgba(184,134,11,0.35);
  }

  .context-box {
    background: rgba(184,134,11,0.06);
    border-radius: 2px;
    padding: 1.25rem 1.25rem 1.25rem 1rem;
    border-left: 3px solid rgba(139,58,15,0.5);
  }

  .context-text {
    font-size: 0.9rem;
    font-weight: 300;
    line-height: 1.7;
    color: rgba(245,237,214,0.65);
    font-style: italic;
  }

  /* Loading state */
  .loading-state {
    text-align: center;
    padding: 3rem 1rem;
  }

  .quill-spinner {
    display: inline-block;
    font-size: 2rem;
    animation: quillBob 1.2s ease-in-out infinite;
    margin-bottom: 1rem;
  }

  @keyframes quillBob {
    0%, 100% { transform: translateY(0) rotate(-15deg); }
    50% { transform: translateY(-8px) rotate(-5deg); }
  }

  .loading-text {
    font-size: 0.85rem;
    font-weight: 300;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: rgba(245,237,214,0.4);
  }

  .loading-subtext {
    font-size: 0.75rem;
    color: rgba(245,237,214,0.25);
    margin-top: 0.4rem;
    font-style: italic;
  }

  /* Controls */
  .controls {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    animation: fadeUp 0.8s 0.2s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  .btn {
    flex: 1;
    min-width: 130px;
    padding: 0.85rem 1.5rem;
    font-family: 'Crimson Pro', serif;
    font-size: 0.85rem;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    border: 1px solid rgba(184,134,11,0.4);
    background: transparent;
    color: var(--parchment);
    cursor: pointer;
    border-radius: 1px;
    transition: all 0.25s ease;
    position: relative;
    overflow: hidden;
  }

  .btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: rgba(184,134,11,0.1);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
  }

  .btn:hover::before { transform: scaleX(1); }
  .btn:hover { border-color: var(--gold); color: var(--gold-light); }
  .btn:disabled { opacity: 0.4; cursor: not-allowed; }

  .btn-primary {
    background: rgba(184,134,11,0.15);
    border-color: var(--gold);
    color: var(--gold-light);
  }
  .btn-primary:hover { background: rgba(184,134,11,0.25); }

  /* Status bar */
  .status-bar {
    text-align: center;
    padding: 1rem;
    font-size: 0.8rem;
    font-weight: 300;
    letter-spacing: 0.1em;
    border: 1px solid rgba(184,134,11,0.15);
    border-radius: 1px;
    margin-bottom: 1.5rem;
    animation: fadeUp 0.8s 0.3s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  .status-bar.active { border-color: rgba(74,94,58,0.5); background: rgba(74,94,58,0.08); color: #8ab87a; }
  .status-bar.inactive { color: rgba(245,237,214,0.4); }
  .status-bar.error { border-color: rgba(139,58,15,0.5); background: rgba(139,58,15,0.08); color: #d4875a; }

  /* Voices */
  .voices-section {
    animation: fadeUp 0.8s 0.5s ease forwards;
    opacity: 0;
    transform: translateY(20px);
  }

  .voices-label {
    font-size: 0.65rem;
    letter-spacing: 0.35em;
    text-transform: uppercase;
    color: var(--gold);
    opacity: 0.6;
    margin-bottom: 1rem;
  }

  .voices-list {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
  }

  .voice-chip {
    font-size: 0.78rem;
    font-weight: 300;
    padding: 0.3rem 0.8rem;
    border: 1px solid rgba(184,134,11,0.2);
    border-radius: 20px;
    color: rgba(245,237,214,0.55);
  }

  /* Install banner */
  .install-banner {
    display: none;
    background: rgba(184,134,11,0.1);
    border: 1px solid rgba(184,134,11,0.3);
    border-radius: 2px;
    padding: 1rem 1.25rem;
    margin-bottom: 1.5rem;
    font-size: 0.85rem;
    font-weight: 300;
    line-height: 1.6;
    color: rgba(245,237,214,0.7);
  }

  .install-banner.show { display: block; }
  .install-banner strong { color: var(--gold-light); }

  .ai-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
    font-size: 0.6rem;
    letter-spacing: 0.2em;
    text-transform: uppercase;
    color: rgba(184,134,11,0.5);
    margin-top: 1rem;
  }

  .ai-badge::before { content: '‚ú¶'; font-size: 0.5rem; }

  footer {
    text-align: center;
    margin-top: 3rem;
    font-size: 0.7rem;
    letter-spacing: 0.2em;
    color: rgba(245,237,214,0.2);
    text-transform: uppercase;
  }
</style>
</head>
<body>

<div class="container">
  <header>
    <div class="app-label">Daily Wisdom ¬∑ 7 AM Pacific</div>
    <h1>Founding <em>Wisdom</em></h1>
    <p class="subtitle">Words from history ‚Äî made relevant for today</p>
  </header>

  <div id="installBanner" class="install-banner">
    <strong>üì± To receive daily notifications:</strong> tap the Share button, choose <strong>"Add to Home Screen"</strong>, then open the app from your home screen and enable notifications.
  </div>

  <!-- One-time API key setup -->
  <div class="api-setup" id="apiSetup" style="display:none">
    <div class="api-setup-title">üóù One-time Setup</div>
    <p>This app uses Claude AI to generate a brand new quote every day ‚Äî never repeating. You'll need a free Anthropic API key. <a href="https://console.anthropic.com" target="_blank">Get one at console.anthropic.com</a> ‚Äî the free tier works perfectly.</p>
    <p>Your key is stored <strong>only on this device</strong> and sent directly to Anthropic ‚Äî nowhere else.</p>
    <div class="api-input-row">
      <input class="api-input" type="password" id="apiKeyInput" placeholder="sk-ant-api03-..."/>
      <button class="btn btn-primary" id="btnSaveKey">Save Key</button>
    </div>
  </div>

  <div id="statusBar" class="status-bar inactive">‚óã &nbsp;Notifications not enabled</div>

  <div class="controls">
    <button class="btn btn-primary" id="btnEnable">Enable Notifications</button>
    <button class="btn" id="btnRefresh">New Quote</button>
    <button class="btn" id="btnPreview">Preview Notification</button>
  </div>

  <div class="quote-card" id="quoteCard">
    <div class="loading-state" id="loadingState">
      <div class="quill-spinner">ü™∂</div>
      <div class="loading-text">Consulting the founders...</div>
      <div class="loading-subtext">Generating today's quote</div>
    </div>

    <div id="quoteContent" style="display:none">
      <div class="author-tag" id="authorTag"></div>
      <div class="original-quote" id="originalQuote"></div>
      <div class="quote-meta" id="quoteMeta"></div>

      <div class="divider"><span>Modern Translation</span></div>
      <p class="section-label">What they were saying</p>
      <div class="modern-translation" id="modernTranslation"></div>

      <div class="context-box">
        <p class="section-label">Historical Context</p>
        <p class="context-text" id="contextText"></p>
      </div>

      <div class="ai-badge">Generated by Claude AI ¬∑ Refreshes daily</div>
    </div>
  </div>

  <div class="voices-section">
    <div class="voices-label">Voices in this collection</div>
    <div class="voices-list">
      <span class="voice-chip">Abraham Lincoln</span>
      <span class="voice-chip">Thomas Paine</span>
      <span class="voice-chip">Samuel Adams</span>
      <span class="voice-chip">Mercy Otis Warren</span>
      <span class="voice-chip">William Lloyd Garrison</span>
    </div>
  </div>

  <footer>Founding Wisdom &nbsp;¬∑&nbsp; Daily at 7 AM PST</footer>
</div>

<script>
const SYSTEM_PROMPT = `You are a historian and plain-language educator. Select a real, historically verified quote from one of these five figures: Abraham Lincoln, Thomas Paine, Samuel Adams, Mercy Otis Warren, or William Lloyd Garrison.

Rotate through them so each person is featured roughly equally over time. Use today's date to help vary the selection. Pick meaningful but lesser-known quotes ‚Äî avoid the most clich√©d famous ones everyone already knows.

Respond ONLY with a valid JSON object, no markdown, no backticks, no explanation:
{
  "author": "Full name",
  "quote": "The exact historical quote",
  "date": "Approximate date or year (e.g. 'December 1776' or 'c. 1772')",
  "modern": "A plain, conversational rewrite of what they meant in today's language ‚Äî 2 to 4 sentences",
  "context": "2 to 3 sentences of historical context: what was happening at the time, why they said it, why it mattered"
}`;

// ‚îÄ‚îÄ‚îÄ Storage helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const saveKey  = k  => localStorage.setItem('fw_api_key', k);
const getKey   = () => localStorage.getItem('fw_api_key') || '';
const todayKey = () => {
  const d = new Date();
  return `fw_quote_${d.getFullYear()}_${d.getMonth()}_${d.getDate()}`;
};
const getCache  = () => { try { return JSON.parse(localStorage.getItem(todayKey())); } catch { return null; } };
const setCache  = q  => localStorage.setItem(todayKey(), JSON.stringify(q));

// ‚îÄ‚îÄ‚îÄ Fetch quote from Claude API ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function fetchQuote(forceNew = false) {
  const apiKey = getKey();
  if (!apiKey) { showSetup(); return; }

  if (!forceNew) {
    const cached = getCache();
    if (cached) { renderQuote(cached); return; }
  }

  showLoading();

  const today = new Date().toDateString();
  try {
    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "x-api-key": apiKey,
        "anthropic-version": "2023-06-01",
        "anthropic-dangerous-direct-browser-access": "true"
      },
      body: JSON.stringify({
        model: "claude-sonnet-4-20250514",
        max_tokens: 1000,
        system: SYSTEM_PROMPT,
        messages: [{
          role: "user",
          content: `Today is ${today}. Give me today's daily quote ‚Äî choose a different person than yesterday if possible. Make it a quote that feels fresh and meaningful, not the one everyone already knows.`
        }]
      })
    });

    if (!res.ok) {
      const err = await res.json().catch(() => ({}));
      throw new Error(err.error?.message || `API error ${res.status}`);
    }

    const data = await res.json();
    const raw = data.content.map(b => b.text || '').join('').replace(/```json|```/g, '').trim();
    const quote = JSON.parse(raw);

    setCache(quote);
    renderQuote(quote);
  } catch(err) {
    showError(err.message);
  }
}

// ‚îÄ‚îÄ‚îÄ UI helpers ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function renderQuote(q) {
  document.getElementById('loadingState').style.display = 'none';
  const content = document.getElementById('quoteContent');
  content.style.display = 'block';
  document.getElementById('authorTag').textContent = q.author;
  document.getElementById('originalQuote').textContent = `\u201C${q.quote}\u201D`;
  document.getElementById('quoteMeta').textContent = q.date;
  document.getElementById('modernTranslation').textContent = q.modern;
  document.getElementById('contextText').textContent = q.context;

  const card = document.getElementById('quoteCard');
  card.style.animation = 'none';
  card.offsetHeight;
  card.style.animation = '';
}

function showLoading() {
  document.getElementById('loadingState').style.display = 'block';
  document.getElementById('quoteContent').style.display = 'none';
  document.getElementById('loadingState').innerHTML = `
    <div class="quill-spinner">ü™∂</div>
    <div class="loading-text">Consulting the founders...</div>
    <div class="loading-subtext">Generating today's quote</div>
  `;
}

function showError(msg) {
  document.getElementById('loadingState').style.display = 'block';
  document.getElementById('quoteContent').style.display = 'none';
  document.getElementById('loadingState').innerHTML = `
    <div style="font-size:1.5rem;margin-bottom:0.75rem">‚ö†Ô∏è</div>
    <div class="loading-text" style="color:#d4875a">Something went wrong</div>
    <div class="loading-subtext" style="color:rgba(212,135,90,0.6);margin-bottom:1.5rem">${msg}</div>
    <button class="btn" onclick="fetchQuote(true)" style="flex:none;margin:0 auto">Try Again</button>
  `;
}

function showSetup() {
  document.getElementById('apiSetup').style.display = 'block';
  document.getElementById('loadingState').innerHTML = `
    <div style="font-size:1.5rem;margin-bottom:0.75rem">üóù</div>
    <div class="loading-text">API key needed</div>
    <div class="loading-subtext">Enter your Anthropic API key above to get started</div>
  `;
}

// ‚îÄ‚îÄ‚îÄ Notifications ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let swReg = null;

function updateStatus(state, msg) {
  const bar = document.getElementById('statusBar');
  bar.className = `status-bar ${state}`;
  bar.textContent = state === 'active' ? `‚óè ${msg}` : `‚óã ${msg}`;
}

async function registerSW() {
  if (!('serviceWorker' in navigator)) return null;
  try { return await navigator.serviceWorker.register('./service-worker.js'); }
  catch(e) { console.error(e); return null; }
}

async function enableNotifications() {
  if (!('Notification' in window)) { updateStatus('error', 'Browser does not support notifications'); return; }
  const perm = await Notification.requestPermission();
  if (perm !== 'granted') { updateStatus('error', 'Permission denied ‚Äî allow notifications in browser settings'); return; }
  swReg = await registerSW();
  if (!swReg) { updateStatus('error', 'Service Worker not supported ‚Äî try adding app to home screen first'); return; }
  localStorage.setItem('fw_notifs', '1');
  scheduleNext();
  updateStatus('active', 'Daily notifications enabled ‚Äî 7 AM Pacific every day');
}

function isPDT(date) {
  const y = date.getFullYear();
  const mkSun = (mo, n) => {
    const d = new Date(y, mo, 1);
    d.setDate((7 - d.getDay()) % 7 + (n - 1) * 7 + 1);
    return d;
  };
  return date >= mkSun(2, 2) && date < mkSun(10, 1);
}

function msUntilSevenAMPST() {
  const now = new Date();
  const off = isPDT(now) ? -7 : -8;
  const utc = now.getTime() + now.getTimezoneOffset() * 60000;
  const pst = utc + off * 3600000;
  const pstNow = new Date(pst);
  const target = new Date(pst);
  target.setHours(7, 0, 0, 0);
  if (pstNow.getHours() >= 7) target.setDate(target.getDate() + 1);
  const targetLocal = target.getTime() - off * 3600000 - now.getTimezoneOffset() * 60000;
  return Math.max(targetLocal - Date.now(), 5000);
}

function scheduleNext() {
  const ms = msUntilSevenAMPST();
  console.log(`Next quote notification in ~${Math.round(ms / 3600000)}h`);
  setTimeout(async () => {
    await fetchQuote(true); // Force fresh quote for the new day
    sendNotification();
    scheduleNext();
  }, ms);
}

function sendNotification() {
  const q = getCache();
  if (!swReg?.active || !q) return;
  swReg.active.postMessage({
    type: 'SHOW_NOTIFICATION',
    title: `Today's Wisdom ¬∑ ${q.author}`,
    body: `"${q.quote.substring(0, 110)}${q.quote.length > 110 ? '‚Ä¶' : ''}" ‚Äî Open for modern translation & context.`
  });
}

// ‚îÄ‚îÄ‚îÄ iOS install banner ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function checkInstallPrompt() {
  const isIOS = /iphone|ipad|ipod/i.test(navigator.userAgent);
  const isStandalone = window.navigator.standalone === true;
  if (isIOS && !isStandalone) document.getElementById('installBanner').classList.add('show');
}

// ‚îÄ‚îÄ‚îÄ Init ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
async function init() {
  checkInstallPrompt();

  const apiKey = getKey();
  if (apiKey) {
    fetchQuote(false);
  } else {
    showSetup();
  }

  // Restore notification schedule if previously enabled
  if (localStorage.getItem('fw_notifs') === '1' && Notification.permission === 'granted') {
    swReg = await registerSW();
    if (swReg) {
      scheduleNext();
      updateStatus('active', 'Daily notifications enabled ‚Äî 7 AM Pacific every day');
    }
  }

  document.getElementById('btnSaveKey').addEventListener('click', () => {
    const k = document.getElementById('apiKeyInput').value.trim();
    if (!k.startsWith('sk-ant')) {
      alert('That doesn\'t look right ‚Äî Anthropic API keys start with sk-ant-...');
      return;
    }
    saveKey(k);
    document.getElementById('apiSetup').style.display = 'none';
    fetchQuote(false);
  });

  document.getElementById('btnEnable').addEventListener('click', enableNotifications);
  document.getElementById('btnRefresh').addEventListener('click', () => fetchQuote(true));
  document.getElementById('btnPreview').addEventListener('click', () => {
    if (!localStorage.getItem('fw_notifs')) { alert('Enable notifications first, then try preview.'); return; }
    sendNotification();
  });
}

init();
</script>
</body>
</html>
